
<!DOCTYPE html
  >
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja"><head><meta charset="UTF-8"/><title>SCR32: クライアントサイドのバリデーションを提供し、DOM を介してエラーテキストを追加する | WCAG 2.0 達成方法集
              </title><link rel="stylesheet" type="text/css" href="https://www.w3.org/StyleSheets/TR/2016/W3C-WG-NOTE.css"/><link rel="stylesheet" type="text/css" href="additional.css"/><link rel="stylesheet" type="text/css" href="slicenav.css"/></head><body class="slices toc-inline">
<div><p>【注意】この文書にはより新しいバージョンが存在します: <a href="/translations/WCAG21/Techniques/">WCAG 2.1 達成方法集</a></p>
</div>

<div id="masthead"><p class="logo"><a href="https://www.w3.org/"><img width="72" height="48" alt="W3C" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C"/></a></p><p class="collectiontitle"><a href="Overview.html">WCAG 2.0 達成方法集</a></p></div><div id="skipnav"><p class="skipnav"><a href="#maincontent">Skip to Content (Press Enter)</a></p></div><a name="top"> </a><!-- TOP NAVIGATION BAR --><ul id="navigation"><li><strong><a href="Overview.html#contents" title="Table of Contents">目次</a></strong></li><li><strong><a href="intro.html" title="Introduction to Techniques for WCAG 2.0"><abbr title="Introduction">イントロダクション</abbr></a></strong></li><li><a title="SCR31: フォーカスのある要素の背景色又はボーダーを変更するために、スクリプトを使用する" href="SCR31.html"><strong>前: </strong>
        達成方法 SCR31</a></li><li><a title="SCR33: コンテンツをスクロールし、かつそれを一時停止するメカニズムを提供するためにスクリプトを使用する" href="SCR33.html"><strong>次: </strong>
        達成方法 SCR33</a></li></ul><div class="navtoc"><p>このページのコンテンツ:</p><ul id="navbar"><li><a href="#SCR32-disclaimer">達成方法に関する重要な情報</a></li><li><a href="#SCR32-applicability">適用 (対象)</a></li><li><a href="#SCR32-description">解説</a></li><li><a href="#SCR32-examples">事例</a></li><li><a href="#SCR32-related-techs">関連する達成方法</a></li><li><a href="#SCR32-tests">検証</a></li></ul></div><div class="skiptarget"><a id="maincontent">-</a></div> <h1><a name="SCR32" id="SCR32"> </a>SCR32: クライアントサイドのバリデーションを提供し、DOM を介してエラーテキストを追加する</h1><div id="SCR32-disclaimer"><h2>達成方法に関する重要な情報</h2><p>この達成方法 (参考) の使用法と、この達成方法が WCAG 2.0 達成基準 (規定) とどのように関係するのかに関する重要な情報については、<a href="https://waic.jp/docs/UNDERSTANDING-WCAG20/understanding-techniques.html">WCAG 達成基準の達成方法を理解する</a>を参照のこと。適用 (対象) のセクションは、その達成方法の範囲について説明しており、特定の技術に関する達成方法の存在は、その技術があらゆる状況で WCAG 2.0 を満たすコンテンツを作成するために使用できることを意味するものではない。</p></div><div class="applicability"><h2 id="SCR32-applicability">適用 (対象)</h2><div class="textbody"><p>HTML 又は XHTML で使用されるスクリプト。</p></div></div><p class="referenced">これは、次の達成基準に関連する達成方法である:</p><ul><li><a href="https://waic.jp/docs/WCAG20/Overview.html#minimize-error-identified">
				達成基準 3.3.1 (エラーの特定)</a><ul><li><a href="https://waic.jp/docs/WCAG20/quickref/#minimize-error-identified">
						クイックリファレンス 3.3.1 (エラーの特定)
					</a></li><li><a href="https://waic.jp/docs/UNDERSTANDING-WCAG20/minimize-error-identified.html">
						達成基準 3.3.1 (エラーの特定)を理解する
					</a></li></ul></li><li><a href="https://waic.jp/docs/WCAG20/Overview.html#minimize-error-suggestions">
				達成基準 3.3.3 (エラー修正の提案)</a><ul><li><a href="https://waic.jp/docs/WCAG20/quickref/#minimize-error-suggestions">
						クイックリファレンス 3.3.3 (エラー修正の提案)
					</a></li><li><a href="https://waic.jp/docs/UNDERSTANDING-WCAG20/minimize-error-suggestions.html">
						達成基準 3.3.3 (エラー修正の提案)を理解する
					</a></li></ul></li></ul><h2 id="SCR32-description">解説</h2><div class="textbody"><p>この達成方法の目的は、クライアントサイドでフォームフィールドの検証に失敗したときにエラーメッセージを表示する方法について説明することである。アンカー要素はリスト中でエラーメッセージを表示させる際に使用され、検証が必要なフィールドの上に挿入される。フォーカスをエラーメッセージの場所に移し、利用者の注意を引くために、アンカー要素がエラーメッセージに使用される。アンカー要素の <code>href</code> は、エラーがみつかったフィールドへのページ内リンクを含む。</p><p>配置されたアプリケーションにおいて、もし JavaScript が無効になっていれば、クライアントサイドの検証は行われない。そのため、この達成方法はスクリプトが適合性において信頼できる、又はサーバーサイドの検証技術があらゆるエラーを発見し、エラーを含むフィールドの情報とともにページを返すように用いられている場合のみ、十分であるといえる。</p><div xmlns="" class="note"><p class="prefix"><em>訳注:</em> WAIC では 
SCR32
 に関する<a href="https://waic.jp/docs/as/">アクセシビリティ・サポーテッド（AS）情報</a>を提供している。</p><p>2014 年 6 月版の<a href="https://waic.jp/docs/as/info/201406/SCR32.html">アクセシビリティ・サポーテッド（AS）情報: SCR32</a>
    では、「達成可能」と評価されている。WAIC はこの達成方法が検証した環境で広く動作すると判断している。
  </p></div></div><h2 class="small-head" id="SCR32-examples">事例</h2><h3 class="small-head" id="SCR32-ex1">事例 1</h3><div class="example"><div class="textbody"><p>この事例は必須のフィールドを検証し、さらに特定の書式が必要なフィールドを検証する。エラーがみつかったとき、スクリプトはエラーメッセージの一覧を DOM に挿入し、フォーカスをそこへ移動する。</p><img src="http://www.w3.org/TR/2008/NOTE-WCAG20-TECHS-20081211/working-examples/SCR32/form2.jpg" class="eximg" alt="サンプルの画面イメージ: スクリーンショットは、正しく記入が行われていないいくつかのフィールドのエラーメッセージをあらわしている。エラーメッセージはリンクリストでフォームの先頭近くに現れる。"/><p> <em>HTML 及び Javascript のコード</em> </p><p>これは事例のフォームの HTML である:</p></div><div class="code"><p><strong>コード例:</strong></p><pre><code>
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Form Validation&lt;/title&gt;
        &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"/&gt;
        &lt;link href="css/validate.css" rel="stylesheet" type="text/css"/&gt;
        &lt;script type="text/javascript" src="scripts/validate.js"/&gt;
    &lt;/head&gt;
    &lt;body&gt;

        &lt;h1&gt;Form Validation&lt;/h1&gt;

        &lt;p&gt;The following form is validated before being submitted if scripting is available,
            otherwise the form is validated on the server. All fields are required, except those
            marked optional. If errors are found in the submission, the form is cancelled and 
            a list of errors is displayed at the top of the form.&lt;/p&gt;

        &lt;p&gt; Please enter your details below. &lt;/p&gt;

        &lt;h2&gt;Validating Form&lt;/h2&gt;

        &lt;form id="personalform" method="post" action="index.php"&gt;
            &lt;div class="validationerrors"/&gt;
            &lt;fieldset&gt;
                &lt;legend&gt;Personal Details&lt;/legend&gt;
                &lt;p&gt;
                    &lt;label for="forename"&gt;Please enter your forename&lt;/label&gt;
                    &lt;input type="text" size="20" name="forename" id="forename" class="string"
                        value=""/&gt;
                &lt;/p&gt;
                &lt;p&gt;
                    &lt;label for="age"&gt;Please enter your age&lt;/label&gt;
                    &lt;input type="text" size="20" name="age" id="age" class="number" value=""/&gt;
                &lt;/p&gt;
                &lt;p&gt;
                    &lt;label for="email"&gt;Please enter your email address&lt;/label&gt;
                    &lt;input type="text" size="20" name="email" id="email" class="email" value=""/&gt;
                &lt;/p&gt;
            &lt;/fieldset&gt;
            &lt;p&gt;
                &lt;input type="submit" name="signup" value="Sign up"/&gt;
            &lt;/p&gt;
        &lt;/form&gt;
        &lt;h2&gt;Second Form&lt;/h2&gt;
        &lt;form id="secondform" method="post" action="index.php#focuspoint"&gt;
            &lt;div class="validationerrors"/&gt;
            &lt;fieldset&gt;
                &lt;legend&gt;Second Form Details&lt;/legend&gt;
                &lt;p&gt;
                    &lt;label for="suggestion"&gt;Enter a suggestion&lt;/label&gt;
                    &lt;input type="text" size="20" name="suggestion" id="suggestion" 
                      class="string" value=""/&gt;
                &lt;/p&gt;
                &lt;p&gt;
                    &lt;label for="optemail"&gt;Please enter your email address (optional)&lt;/label&gt;
                    &lt;input type="text" size="20" name="optemail" id="optemail"
                        class="optional email" value=""/&gt;
                &lt;/p&gt;
                &lt;p&gt;
                    &lt;label for="rating"&gt;Please rate this suggestion&lt;/label&gt;
                    &lt;input type="text" size="20" name="rating" id="rating" 
                      class="number" value=""/&gt;
                &lt;/p&gt;
                &lt;p&gt;
                    &lt;label for="jibberish"&gt;Enter some jibberish (optional)&lt;/label&gt;
                    &lt;input type="text" size="20" name="jibberish" id="jibberish" value=""/&gt;
                &lt;/p&gt;

            &lt;/fieldset&gt;
            &lt;p&gt;
                &lt;input type="submit" name="submit" value="Add Suggestion"/&gt;
            &lt;/p&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;                      </code></pre></div><div class="textbody"><p>以下は検証を行ってエラーメッセージを挿入する JavaScript である:</p></div><div class="code"><p><strong>コード例:</strong></p><pre><code>
window.onload = initialise;

function initialise()
{
   var objForms = document.getElementsByTagName('form');
   var iCounter;

   // フォームそれぞれにイベントハンドラを追加
   for (iCounter=0; iCounter&lt;objForms.length; iCounter++)
   {
      objForms[iCounter].onsubmit = function(){return validateForm(this);};
   }
}


// フォームのイベントハンドラ
function validateForm(objForm)
{
   var arClass = [];
   var iErrors = 0;
   var objField = objForm.getElementsByTagName('input');
   var objLabel = objForm.getElementsByTagName('label');
   var objList = document.createElement('ol');
   var objError, objExisting, objNew, objTitle, objParagraph, objAnchor, objPosition;
   var strLinkID, iFieldCounter, iClassCounter, iCounter;

   // 部分識別子を固有にするため、
   // フォームのid又はnameを取得する
   if (objForm.id)
   {
      strLinkID = objForm.id + 'ErrorID';
   }
   else
   {
      strLinkID = objForm.name + 'ErrorID';
   }

   // validationクラスを探索するため、inputフォームコントロールをループする
   for (iFieldCounter=0; iFieldCounter&lt;objField.length; iFieldCounter++)
   {
      // フィールドのクラスを取得し、適切なクラスを探す
      arClass = objField[iFieldCounter].className.split(' ');
      for (iClassCounter=0; iClassCounter&lt;arClass.length; iClassCounter++)
      {
         switch (arClass[iClassCounter])
         {
            case 'string':
               if (!isString(objField[iFieldCounter].value, arClass))
               {
                  if (iErrors === 0)
                  {
                     logError(objField[iFieldCounter], objLabel, objList, strLinkID);
                  }
                  else
                  {
                     logError(objField[iFieldCounter], objLabel, objList, '');
                  }
                  iErrors++;
               }
               break;
            case 'number':
               if (!isNumber(objField[iFieldCounter].value, arClass))
               {
                  if (iErrors === 0)
                  {
                     logError(objField[iFieldCounter], objLabel, objList, strLinkID);
                  }
                  else
                  {
                     logError(objField[iFieldCounter], objLabel, objList, '');
                  }
                  iErrors++;
               }
               break;

            case 'email' :
               if (!isEmail(objField[iFieldCounter].value, arClass))
               {
                  if (iErrors === 0)
                  {
                     logError(objField[iFieldCounter], objLabel, objList, strLinkID);
                  }
                  else
                  {
                     logError(objField[iFieldCounter], objLabel, objList, '');
                  }
                  iErrors++;
               }
               break;
         }
      }
   }

   if (iErrors &gt; 0)
   {
      // validではない場合、エラーメッセージを表示する
      objError = objForm.getElementsByTagName('div');
      
      // 存在しているエラーを探す
      for (iCounter=0; iCounter&lt;objError.length; iCounter++)
      {
         if (objError[iCounter].className == 'validationerrors')
         {
            objExisting = objError[iCounter];
         }
      }

      objNew = document.createElement('div');
      objTitle = document.createElement('h2');
      objParagraph = document.createElement('p');
      objAnchor = document.createElement('a');

      if (iErrors == 1)
      {
         objAnchor.appendChild(document.createTextNode('1 Error in Submission'));
      }
      else
      {
         objAnchor.appendChild(document.createTextNode(iErrors + ' Errors in Submission'));
      }
      objAnchor.href = '#' + strLinkID;
      objAnchor.className = 'submissionerror';

      objTitle.appendChild(objAnchor);
      objParagraph.appendChild(document.createTextNode('Please review the following'));

      objNew.className = 'validationerrors';

      objNew.appendChild(objTitle);
      objNew.appendChild(objParagraph);
      objNew.appendChild(objList);
      
      // 既にエラーがある場合、新しいエラーと交換する。
      // それ以外の場合、フォームの先頭に新しいエラーを追加する。
      if (objExisting)
      {
         objExisting.parentNode.replaceChild(objNew, objExisting);
      }
      else
      {
         objPosition = objForm.firstChild;
         objForm.insertBefore(objNew, objPosition);
      }

      // 待ち時間の設定
      setTimeout(function() { objAnchor.focus(); }, 50);
      
      // フォームを送信しない
      objForm.submitAllowed = false;
      return false;
   }

   // フォームを送信
   return true;
}

// 問題のあるフィールドコントロールを指すリスト項目にリンクを追加する関数
function addError(objList, strError, strID, strErrorID)
{
   var objListItem = document.createElement('li');
   var objAnchor = document.createElement('a');
   
   // フォームコントロールへの部分識別子
   objAnchor.href='#' + strID;

   // エラーの見出しに向けたターゲットにする
   if (strErrorID.length &gt; 0)
   {
      objAnchor.id = strErrorID;
   }

   // エラーメッセージ用のラベルプロンプトを使う
   objAnchor.appendChild(document.createTextNode(strError));
   // フォームコントロールにフォーカスを当てるために、キーボード及びマウスイベントを追加する
   objAnchor.onclick = function(event){return focusFormField(this, event);};
   objAnchor.onkeypress = function(event){return focusFormField(this, event);};
   objListItem.appendChild(objAnchor);
   objList.appendChild(objListItem);
}

function focusFormField(objAnchor, objEvent)
{
   var strFormField, objForm;

   // キーボードでもリンクが機能するようにする
   if (objEvent &amp;amp;&amp;amp; objEvent.type == 'keypress')
   {
      if (objEvent.keyCode != 13 &amp;amp;&amp;amp; objEvent.keyCode != 32)
      {
         return true;
      }
   }

   // フォームコントロールにフォーカスを当てる
   strFormField = objAnchor.href.match(/[^#]\w*$/);
   objForm = getForm(strFormField);
   objForm[strFormField].focus();
   return false;
}

// 与えられたフォームフィールドの名前から、フォーム要素を返す関数
function getForm(strField)
{
   var objElement = document.getElementById(strField);

   // 適切なフォームを探す
   do
   {
      objElement = objElement.parentNode;
   } while (!objElement.tagName.match(/form/i) &amp;amp;&amp;amp; objElement.parentNode);

   return objElement;
}

// リスト中のエラーを記録する関数
function logError(objField, objLabel, objList, strErrorID)
{
   var iCounter, strError;

   // エラープロンプトのラベルを探す
   for (iCounter=0; iCounter&lt;objLabel.length; iCounter++)
   {
      if (objLabel[iCounter].htmlFor == objField.id)
      {
         strError = objLabel[iCounter].firstChild.nodeValue;
      }
   }

   addError(objList, strError, objField.id, strErrorID);
}

// 検証ルーティン - 要求事項として

function isString(strValue, arClass)
{
   var bValid = (typeof strValue == 'string' &amp;amp;&amp;amp; strValue.replace(/^\s*|\s*$/g, '') 
     !== '' &amp;amp;&amp;amp; isNaN(strValue));

   return checkOptional(bValid, strValue, arClass);
}

function isEmail(strValue, arClass)
{
   var objRE = /^[\w-\.\']{1,}\@([\da-zA-Z\-]{1,}\.){1,}[\da-zA-Z\-]{2,}$/;
   var bValid = objRE.test(strValue);

   return checkOptional(bValid, strValue, arClass);
}

function isNumber(strValue, arClass)
{
   var bValid = (!isNaN(strValue) &amp;amp;&amp;amp; strValue.replace(/^\s*|\s*$/g, '') !== '');

   return checkOptional(bValid, strValue, arClass);
}

function checkOptional(bValid, strValue, arClass)
{
   var bOptional = false;
   var iCounter;

   // optionalについて確認
   for (iCounter=0; iCounter&lt;arClass.length; iCounter++)
   {
      if (arClass[iCounter] == 'optional')
      {
         bOptional = true;
      }
   }

   if (bOptional &amp;amp;&amp;amp; strValue.replace(/^\s*|\s*$/g, '') === '')
   {
      return true;
   }

   return bValid;
   }</code></pre></div><div class="textbody"><p>このコードの実装サンプルは、PHP、JavaScript、CSS 及び XHTML で実装されている: <a href="https://www.w3.org/WAI/WCAG20/Techniques/working-examples/SCR32/index.php">フォーム検証の例</a></p></div></div><h2 id="SCR32-related-techs">関連する達成方法</h2><div class="textbody"><ul><li><a href="G83.html">G83: 入力が完了していない必須項目を特定するために、テキストの説明を提供する</a></li><li><a href="G85.html">G85: 利用者の入力が要求されたフォーマット又は値の範囲外の場合に、テキストの説明を提供する</a></li><li><a href="SCR18.html">SCR18: クライアントサイドのバリデーション及びアラートを提供する</a></li></ul></div><h2 id="SCR32-tests">検証</h2><div class="textbody"><h3 class="small-head" id="SCR32-procedure">手順</h3><p>アンカータグを用いてエラーメッセージを作成し、上記の達成方法による適切なスクリプトを使用する。</p><ol class="enumar"><li><p>ページを読み込む。</p></li><li><p>エラーメッセージに関連付けられたフィールドに有効な値を入力し、エラーメッセージが表示されないことを確認する。</p></li><li><p>エラーメッセージに関連付けられたフィールドに無効な値を入力し、そのフィールドに正確なエラーメッセージが表示されることを確認する。</p></li><li><p>エラーメッセージがフォーカスを受け取ることを確認する。</p></li><li><p>表示されたエラーメッセージと関連付けられたフィールドに有効な値を入力し、エラーメッセージが除去されることを確認する。</p></li><li><p>アンカータグによって作例されたエラーメッセージと関連付けられた全てのフィールドに対して、繰り返す。</p></li></ol><div class="note"><p class="prefix"><em>注記: </em>上記の手順を、支援技術を用いて実行することも推奨する。</p></div><h3 class="small-head" id="SCR32-results">期待される結果</h3><ul><li><p>2.、3.、4. 及び 5. の全ての結果が真である。</p></li></ul><p>この達成方法が「十分な達成方法」の一つである場合、この手順や期待される結果を満たしていなければ、それはこの達成方法が正しく用いられていないことを意味するが、必ずしも達成基準を満たしていないことにはならない。場合によっては、別の達成方法によってその達成基準が満たされていることもありうる。</p></div><!-- BOTTOM NAVIGATION BAR --><ul id="navigationbottom"><li><strong><a href="#top">このページの先頭へ</a></strong></li><li><strong><a href="Overview.html#contents" title="Table of Contents">目次</a></strong></li><li><strong><a href="intro.html" title="Introduction to Techniques for WCAG 2.0"><abbr title="Introduction">イントロダクション</abbr></a></strong></li><li><a title="SCR31: フォーカスのある要素の背景色又はボーダーを変更するために、スクリプトを使用する" href="SCR31.html"><strong>前: </strong>
        達成方法 SCR31</a></li><li><a title="SCR33: コンテンツをスクロールし、かつそれを一時停止するメカニズムを提供するためにスクリプトを使用する" href="SCR33.html"><strong>次: </strong>
        達成方法 SCR33</a></li></ul><div class="footer"><p class="copyright">このウェブページは、<a href="Overview.html">WCAG 2.0 達成方法集: WCAG 2.0 の達成方法と失敗例</a> (<a href="https://www.w3.org/TR/WCAG20-TECHS/SCR32.html">この文書の最新版 (英語)</a> を参照してください) の一部です。文書全体を<a href="complete.html">単一 HTML ファイルにしたもの</a>もご利用いただけます。この文書と、Web Content Accessibility Guidelines (WCAG) 2.0 に関連する他の文書との関係については、<a href="http://www.w3.org/WAI/intro/wcag20">The WCAG 2.0 Documents</a> をご覧ください。パブリックコメントを送るには、<a href="http://www.w3.org/WAI/WCAG20/comments/">Instructions for Commenting on WCAG 2.0 Documents</a> に従ってください。</p><p class="copyright"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2016 <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.</p><p>【注意】 この文書は、W3C ワーキンググループノート <a href="https://www.w3.org/TR/2016/NOTE-WCAG20-TECHS-20161007/">Techniques for WCAG 2.0 の 2016 年 10 月 7 日時点での最新版</a>を<a href="https://waic.jp/committee/wg4/">ウェブアクセシビリティ基盤委員会 (WAIC)</a> が翻訳して公開しているものです。この文書の正式版は、W3C のサイトにある英語版です。正確な内容については、W3C が公開している原文 (英語) をご確認ください。この翻訳文書はあくまで参考情報であり、翻訳上の誤りが含まれていることがあります。翻訳上の誤りを見つけられた場合は、<a href="https://waic.jp/contact/" id="file-issue">翻訳に関するお問い合わせ</a>からご連絡ください。</p><p>【重要】 達成方法のタイトルが英語のままになっているものは、日本語訳を行っていないため、原文 (英語) にリンクしています。</p></div><script src="https://waic.jp/docs/js/translation-contact.js"> </script></body></html>